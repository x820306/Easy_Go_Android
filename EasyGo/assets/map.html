<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
<script type="text/javascript" 
        src="http://maps.google.com/maps/api/js?libraries=geometry&sensor=true"></script>
<script type="text/javascript">
var geocoder;
var map;
var directionsService;
var directionsDisplay=null;
var stepDisplay;
var marker_s=null;
var marker_e=null;
var sp=null;
var ep=null;
var addr_s;
var addr_e;
var markerArray=[];
var markerArray0=[];
var markerArrayt=[];


  function initialize() {
    var myLatlng = new google.maps.LatLng(25.047968, 121.517081);  //地圖中心點
    var myOptions = {
           zoom: 17,
           center: myLatlng,
           mapTypeId: google.maps.MapTypeId.ROADMAP               //道路地圖
    }
    map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
	geocoder = new google.maps.Geocoder();
	directionsService = new google.maps.DirectionsService();
	stepDisplay = new google.maps.InfoWindow();
  }
  
  function startLocation(lat,lon) {
	  
			 var latlng = new google.maps.LatLng(lat,lon);
			 geocoder.geocode({'latLng': latlng}, function(results, status) {
     			 if (status == google.maps.GeocoderStatus.OK) {
        			if (results[0]) {
						var temp=results[0].formatted_address;
						window.android.setStartLocation(temp);
					}
                 } else {
                    
                 }
             });
  }
  
   function endLocation(lat,lon) {
	  
			 var latlng = new google.maps.LatLng(lat,lon);
			 geocoder.geocode({'latLng': latlng}, function(results, status) {
     			 if (status == google.maps.GeocoderStatus.OK) {
        			if (results[0]) {
						var temp=results[0].formatted_address;
						window.android.setEndLocation(temp);
					}
                 } else {
                    
                 }
             });
  }
  
  function frp(addr_s0,addr_e0) {
		
		addr_s = addr_s0;
        addr_e = addr_e0;
		
		geocoder.geocode( { 'address': addr_s}, function(results, status) {
      		if (status == google.maps.GeocoderStatus.OK) {
        		map.setCenter(results[0].geometry.location);
       			if(marker_s!=null)
				{
					marker_s.setMap(null);
				}
				marker_s = new google.maps.Marker({
            		map: map,
            		position: results[0].geometry.location
        		});
				sp=results[0].geometry.location;
		
    			geocoder.geocode( { 'address': addr_e}, function(results1, status1) {
      				if (status1 == google.maps.GeocoderStatus.OK) {
        				map.setCenter(results1[0].geometry.location);
						if(marker_e!=null)
						{
							marker_e.setMap(null);
						}
        				marker_e = new google.maps.Marker({
            				map: map,
            				position: results1[0].geometry.location
        				});
						ep=results1[0].geometry.location;
						
						var rad0;
						var center0;
						var lt;
						var lg;
						
						
						if((ep.lat()==sp.lat())&&(ep.lng()==sp.lng())){

								    lt=sp.lat();
									lg=sp.lng();
									center0=lt+','+lg;
								    rad0=1;

						}else{

									   lt=(sp.lat()+ep.lat())/2;
									   lg=(sp.lng()+ep.lng())/2

									   var step3=google.maps.geometry.spherical.computeDistanceBetween(sp,ep)/1000/2;
									   if(step3<1){step3=1;}

								       center0=lt+','+lg;
								       rad0=step3;
						}
						
						
						window.android.frpReturn(center0,rad0,lt,lg);
						
						
					} else {
        				
      				}
	  			});
		 	} else {
        		
      		}
	  	});
	  
	}
	
	function setMarkers(ctr) {
		
		for(i=0;i<ctr;i++){
			var rec=i;
			var loc=window.android.getRPLocation(rec);
			var tle=window.android.getRPTitle(rec);
			
			
			var icon_t="https://chart.googleapis.com/chart?chst=d_map_pin_icon&chld=glyphish_compass|FF0000|000000";
	
	        var xxx0=loc.split(",");
			var aaa0=xxx0[0];
			var bbb0=xxx0[1];
			
			tle=tle.replace(/&/g, "<br/><br/>");
			tle=tle.replace(/#/g, "<br/><br/>#")
							
			var ccc0=new google.maps.LatLng(aaa0,bbb0);
			var marker_temp0= new google.maps.Marker({
                    position: ccc0,
                    map: map,
					icon: icon_t
            });
							
			var hml='<p>'+tle+'</p><br/><button onclick="">選擇</button>';

			attachInstructionText(marker_temp0,hml);

			markerArrayt.push(marker_temp0);
							
		 }
		 
		for(i=0;i<markerArrayt.length;i++)
		{
			markerArrayt[i].setAnimation(google.maps.Animation.BOUNCE);
			
		}

	}
	
  function attachInstructionText(markerr, text) {
    google.maps.event.addListener(markerr, 'click', function() {
      // Open an info window when the marker is clicked on,
      // containing the text of the step.
      stepDisplay.setContent(text);
      stepDisplay.open(map, markerr);
    });
  }
  
</script>
</head>
<body style="margin:0px; padding:0px;" onLoad="initialize()">
  <div id="map_canvas" style="width:100%; height:100%"></div>
</body>
</html>